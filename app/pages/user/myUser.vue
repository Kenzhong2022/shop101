/** * ä¼šå‘˜ä¸­å¿ƒé¡µé¢ * * åŠŸèƒ½ç‰¹ç‚¹ï¼š * - å±•ç¤ºç”¨æˆ·ä¸ªäººä¿¡æ¯ * - ä¼šå‘˜ç­‰çº§å’Œç§¯åˆ†ç³»ç»Ÿ *
- è®¢å•ç®¡ç† * - ä¸ªäººè®¾ç½® * - ä¼šå‘˜ä¸“å±åŠŸèƒ½ */

<template>
  <div class="min-h-screen bg-gray-50">
    <!-- å€’è®¡æ—¶ç»„ä»¶:æ˜¾ç¤ºtokençš„æœ‰æ•ˆæ—¶é—´ -->
    <h2>
      è¿˜æœ‰
      <el-countdown
        :value="expTime"
        format="HH:mm:ss"
        :auto-start="true"
        @finish="handleTokenExpire"
      />
      tokenå°±ä¼šè¿‡æœŸ
    </h2>
    <h2>
      è¿‡æœŸæ—¶é—´ä¸ºï¼š{{
        formatTime(useUser.expireTime, {
          format: "dateTime",
          dateSeparator: "-",
          timeSeparator: ":",
        })
      }}
    </h2>

    <!-- é¡µé¢å¤´éƒ¨ -->
    <div class="bg-gradient-to-r from-primary-500 to-primary-600 text-white">
      <div class="max-w-6xl mx-auto px-4 py-8">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-4">
            <div
              class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center"
            >
              <span class="text-2xl">ğŸ‘¤</span>
            </div>
            <div>
              <h1 class="text-2xl font-bold">æ¬¢è¿æ¥åˆ°ä¼šå‘˜ä¸­å¿ƒ</h1>
              <p class="text-primary-100">ç®¡ç†æ‚¨çš„ä¸ªäººä¿¡æ¯å’Œè®¢å•</p>
            </div>
          </div>
          <div class="text-right">
            <div class="text-sm text-primary-100">ä¼šå‘˜ç­‰çº§</div>
            <div class="text-lg font-semibold">é»„é‡‘ä¼šå‘˜</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <div class="max-w-6xl mx-auto px-4 py-8">
      <!-- ä¼šå‘˜ç»Ÿè®¡å¡ç‰‡ -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="color-card text-center">
          <div class="text-3xl font-bold text-primary mb-2">1,250</div>
          <div class="text-sm text-gray-600">å¯ç”¨ç§¯åˆ†</div>
        </div>
        <div class="color-card text-center">
          <div class="text-3xl font-bold text-el-success mb-2">8</div>
          <div class="text-sm text-gray-600">å¾…è¯„ä»·è®¢å•</div>
        </div>
        <div class="color-card text-center">
          <div class="text-3xl font-bold text-el-warning mb-2">3</div>
          <div class="text-sm text-gray-600">ä¼˜æƒ åˆ¸</div>
        </div>
      </div>

      <!-- åŠŸèƒ½å¯¼èˆª -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <div
          class="color-card hover:shadow-md transition-shadow cursor-pointer"
        >
          <div class="text-center p-6">
            <div class="text-3xl mb-3">ğŸ“‹</div>
            <h3 class="font-semibold text-gray-800 mb-2">æˆ‘çš„è®¢å•</h3>
            <p class="text-sm text-gray-600">æŸ¥çœ‹è®¢å•çŠ¶æ€å’Œå†å²è®°å½•</p>
          </div>
        </div>

        <div
          class="color-card hover:shadow-md transition-shadow cursor-pointer"
        >
          <div class="text-center p-6">
            <div class="text-3xl mb-3">â¤ï¸</div>
            <h3 class="font-semibold text-gray-800 mb-2">æˆ‘çš„æ”¶è—</h3>
            <p class="text-sm text-gray-600">ç®¡ç†æ”¶è—çš„å•†å“</p>
          </div>
        </div>

        <div
          class="color-card hover:shadow-md transition-shadow cursor-pointer"
        >
          <div class="text-center p-6">
            <div class="text-3xl mb-3">ğŸ¯</div>
            <h3 class="font-semibold text-gray-800 mb-2">ç§¯åˆ†å•†åŸ</h3>
            <p class="text-sm text-gray-600">ç§¯åˆ†å…‘æ¢å•†å“</p>
          </div>
        </div>

        <div
          class="color-card hover:shadow-md transition-shadow cursor-pointer"
        >
          <div class="text-center p-6">
            <div class="text-3xl mb-3">âš™ï¸</div>
            <h3 class="font-semibold text-gray-800 mb-2">è´¦æˆ·è®¾ç½®</h3>
            <p class="text-sm text-gray-600">ä¿®æ”¹ä¸ªäººä¿¡æ¯</p>
          </div>
        </div>
      </div>

      <!-- æœ€è¿‘æ´»åŠ¨ -->
      <div class="color-card">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">æœ€è¿‘æ´»åŠ¨</h3>
        <div class="space-y-4">
          <div
            class="flex items-center justify-between p-3 bg-gray-50 rounded-lg"
          >
            <div class="flex items-center space-x-3">
              <span class="text-green-500">âœ…</span>
              <span class="text-sm">è®¢å• #202412001 å·²å®Œæˆ</span>
            </div>
            <span class="text-xs text-gray-500">2å°æ—¶å‰</span>
          </div>

          <div
            class="flex items-center justify-between p-3 bg-gray-50 rounded-lg"
          >
            <div class="flex items-center space-x-3">
              <span class="text-blue-500">ğŸ’°</span>
              <span class="text-sm">è·å¾—50ç§¯åˆ†å¥–åŠ±</span>
            </div>
            <span class="text-xs text-gray-500">1å¤©å‰</span>
          </div>

          <div
            class="flex items-center justify-between p-3 bg-gray-50 rounded-lg"
          >
            <div class="flex items-center space-x-3">
              <span class="text-orange-500">ğŸ</span>
              <span class="text-sm">é¢†å–äº†æ–°ä¼˜æƒ åˆ¸</span>
            </div>
            <span class="text-xs text-gray-500">3å¤©å‰</span>
          </div>
        </div>
      </div>
    </div>

    <!-- æ§åˆ¶å°æµ‹è¯•ä¿¡æ¯ -->
    <div
      class="fixed bottom-4 right-4 bg-black/80 text-white px-4 py-2 rounded-lg text-xs"
    >
      è·¯ç”±å®ˆå«å·²æ¿€æ´» - æŸ¥çœ‹æ§åˆ¶å°
    </div>
  </div>
</template>

<script setup lang="ts">
// é¡µé¢å…ƒä¿¡æ¯é…ç½®
// è¿™é‡Œå¯ä»¥æ·»åŠ æ›´å¤šè·¯ç”±å…ƒä¿¡æ¯ï¼Œç”¨äºè·¯ç”±å®ˆå«åˆ¤æ–­
definePageMeta({
  title: "ç”¨æˆ·ä¸­å¿ƒ",
  layout: "default",
  pageInfo: {
    requiresAuth: true, // æ ‡è®°éœ€è¦è®¤è¯
    pageType: "user-center", // é¡µé¢ç±»å‹
  },
});

import { useUser } from "~/composables/useUser";
import formatTime from "~/composables/tools";

const expTime = ref<number>(0);

// é¡µé¢åŠ è½½å®Œæˆåçš„æ“ä½œ
onMounted(() => {
  console.log("ğŸ‰ ä¼šå‘˜ä¸­å¿ƒé¡µé¢å·²åŠ è½½å®Œæˆ");
  console.log("ğŸ“± å½“å‰é¡µé¢: ç”¨æˆ·ä¸­å¿ƒ");
  // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æ›´å¤šé¡µé¢åˆå§‹åŒ–é€»è¾‘
  // ä¾‹å¦‚ï¼šåŠ è½½ç”¨æˆ·æ•°æ®ã€è·å–ä¼šå‘˜ä¿¡æ¯ç­‰
});

onActivated(() => {
  console.log("é¡µé¢æ¿€æ´»æ—¶è°ƒç”¨");
  // é‡æ–°è·å–cookieä¸­çš„token
  useUser.value.token = useCookie("auth-token").value as string;
  useUser.value.expireTime = Number(useUser.value.token.split(".")[1]);

  // æ£€æŸ¥tokenæ˜¯å¦è¿‡æœŸ
  // ä½¿ç”¨composablesä¸­useUserçš„ä¿¡æ¯
  expTime.value = useUser.value.expireTime;
  console.log("token:", useUser.value.token);
  console.log("è¿‡æœŸæ—¶é—´:", typeof useUser.value.expireTime);
  let t = new Date().getTime();
  console.log(
    "å½“å‰æ—¶é—´:",
    formatTime(t, {
      format: "dateTime",
      dateSeparator: "-",
      timeSeparator: ":",
    })
  );
  console.log(
    "è¿‡æœŸæ—¶é—´æ ¼å¼åŒ–:",
    formatTime(useUser.value.expireTime, {
      format: "dateTime",
      dateSeparator: "-",
      timeSeparator: ":",
    })
  );
});

// å¤„ç†tokenè¿‡æœŸ
function handleTokenExpire() {
  console.log("tokenå·²è¿‡æœŸ");
  // æ¸…é™¤è¿‡æœŸçš„token
  // localStorage.removeItem("token");
  // è·³è½¬åˆ°ç™»å½•é¡µé¢
  navigateTo("/login/myLogin");
}
</script>

<style lang="scss" scoped>
// å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ é¡µé¢ç‰¹å®šçš„æ ·å¼
.color-card {
  @apply p-4 rounded-lg shadow-sm border border-gray-200 bg-white;
}
</style>
